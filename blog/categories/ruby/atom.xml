<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | Memos]]></title>
  <link href="http://akiko74.github.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://akiko74.github.com/"/>
  <updated>2014-02-13T16:04:24+09:00</updated>
  <id>http://akiko74.github.com/</id>
  <author>
    <name><![CDATA[Akiko Saito]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RMagickで静止画から動画を作る]]></title>
    <link href="http://akiko74.github.com/blog/2014/02/13/rmagick/"/>
    <updated>2014-02-13T15:37:00+09:00</updated>
    <id>http://akiko74.github.com/blog/2014/02/13/rmagick</id>
    <content type="html"><![CDATA[<p>たくさんの静止画、いわゆるパラパラ漫画状態からmp4形式の動画を作るまでのプロセスメモ。</p>

<h1 id="toc_25">環境</h1>

<h2 id="toc_26">開発環境</h2>

<p>CentOS6が乗っているVPSにruby2.1.0+Rails4.0を入れて使ってます。</p>

<h2 id="toc_27">事前準備</h2>

<p>画像を扱うため、RMagickをgemでインストールします。
RMagickはImageMagickをRubyで扱うためのインターフェースなので、ImageMagickが入ってない場合はそれもインストール画筆用です。
画像管理にはPaperclipを使いました。</p>

<!--more-->

<h1 id="toc_28">動画作成</h1>

<h2 id="toc_29">画像を取り込む</h2>

<p>必要なライブラリを読み込みます。</p>

<p>画像から動画への変換はシンプルで、Magick::ImageListというClassで複数枚の画像を扱えるため、まずは器を作ります
。</p>

<p>ドキュメントには、ImageListは配列と同じという記述があるので、配列に動画にしたい画像を追加していきます。</p>

<p>追加するイメージもMagick::Image.readで指定します。フレーム指定が出来るメソッドのため結果が配列になる模様。<br>
そのため、firstでイメージそのものを指定します。<br>
もっとよいやり方がありそうですが、ひとまずやりたいことが実現できたのでこの方法でよしとしました。</p>

<p>余談ですが、最初は「&lt;&lt;」で追加できると思いましたが、なぜか出来ずpushに。なんとなく配列だったら「&lt;&lt;」を使いたい。</p>

<h2 id="toc_30">画像を動画に変換</h2>

<p>これだけでmovieの配列に入っている画像をまとめてmp4にしてくれます。</p>

<p>便利！！！</p>

<p><a href="http://rubydoc.info/gems/rmagick/2.13.1/index">RMagick</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nokogiriでノードを指定]]></title>
    <link href="http://akiko74.github.com/blog/2013/12/22/nokogiri/"/>
    <updated>2013-12-22T18:21:00+09:00</updated>
    <id>http://akiko74.github.com/blog/2013/12/22/nokogiri</id>
    <content type="html"><![CDATA[<p>Seleniumでスクレイピングをするときに、併せて使われる<a href="http://nokogiri.org/">Nokogiri</a>ですが、パスの指定がよくわからなくなるので、一通りメモをしておきます。</p>

<h2 id="toc_31">Xpathで指定する</h2>

<p>XPathはFirefoxのfirebugで探したい場所を右クリックすると「XPathをコピー」というのが出て来て便利。
これは絶対pathなので、長くなると可読性に欠ける。相対pathに出来るとよいのですが、とりあえずはこれで良しとします。</p>

<!--more-->

<h2 id="toc_32">CSSで指定する</h2>

<p>&lt;div id=&quot;hoge&quot;&gt;を探す。</p>

<p>&lt;div class=&quot;hoge&quot;&gt;を探す。</p>

<p>&lt;table class=&quot;hoge hoge&quot;&gt;を探す。</p>

<p>もしclassがhogeだけだったら、doc.css(&#39;table.hoge&#39;)でもいいらしい。</p>

<h2 id="toc_33">参考にしたサイト</h2>

<p><a href="http://ruby.bastardsbook.com/chapters/html-parsing/">http://ruby.bastardsbook.com/chapters/html-parsing/</a></p>

<p><a href="https://blog.engineyard.com/2010/getting-started-with-nokogiri">https://blog.engineyard.com/2010/getting-started-with-nokogiri</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Seleniumでスクレイピング（準備編）]]></title>
    <link href="http://akiko74.github.com/blog/2013/12/02/selenium/"/>
    <updated>2013-12-02T08:06:00+09:00</updated>
    <id>http://akiko74.github.com/blog/2013/12/02/selenium</id>
    <content type="html"><![CDATA[<p>とあるWebページをスクレイピングしようと思って、Mechanizeを調べていたのですが、乗り越えられないJavascriptの壁。</p>

<p>「SeleniumとXvfbとHeadless」という組み合わせでVPS上にDisplaylessでブラウザを動かすことが出来るということで、環境構築を行います。</p>

<h2 id="toc_34">はじめに</h2>

<p>今回の環境はこんな感じ。今回に限らず、環境は大体こんな感じのところに同居させてます。さくらさん、いろいろ乗せてもサクサク動く気がして、いいですね。</p>

<!-- more -->

<p>実行環境：CentOS6.2(さくらVPS)
          Ruby2.0</p>

<h2 id="toc_35">Xvfbのインストール</h2>

<p>まずはXvfbというパッケージをインストール。これはXを仮想的に作るというイメージのもの。（という理解）Xを立ち上げなくても、仮想スクリーンとしてブラウザを起動してくれる。</p>

<p><code>
yum install Xvfb
</code></p>

<h2 id="toc_36">Headlessのインストール</h2>

<p>HeadlessはXvfbをRubyからコントロールできるGem。便利Gemは誰かが何かしら公開してくれているので有り難い限りです。</p>

<p>というわけで、利用するプロジェクトのGemfileに追加。bundlerを使っているのでbundle installで追加します。</p>

<p><a href="https://github.com/leonid-shevtsov/headless.git">Github</a></p>

<h2 id="toc_37">Seleniumのインストール</h2>

<p>SeleniumもRubyから操作が出来るdriverが公開されています。同じくGemfileに追加します。</p>

<p><code>
&#39;selenium-webdriver&#39;
</code>
たぶん、普通に入ると思います。</p>

<p><a href="https://github.com/vertis/selenium-webdriver.git">Github</a></p>

<h2 id="toc_38">Firefoxのインストール</h2>

<p>yumで入れようとするとFirefox17しか入りません。さすがに古いので、手動で入れます。それにしても、FFのダウンロードページは少し探しにくいんじゃまいか…</p>

<p>で、ここまで準備が出来たのでirbから<a href="https://github.com/leonid-shevtsov/headless">headless</a>の通りにやってみたものの、起動しないでエラーが出てしまいました。
Selenium::WebDriverが見つからない的な表示。</p>

<p>結局、Xを入れたときに入るドライバなどが必要ぽいので、残念ながらXは最初から全部入れないと駄目みたいです。軽く出来るのかと思ったら、そうではない。XvfbはあくまでXありきで動くようです。というわけで、イチからXをインストール。</p>

<p><code>
sudo yum -y groupinstall &quot;X Window System&quot; &quot;Desktop&quot; &quot;Fonts&quot; &quot;General Purpose Desktop&quot;
</code></p>

<p>まるっとインストール出来たら、irbでテストをしてみます。</p>

<p>Xが足りないというのを知らなかったときに見つけた対応策も備忘録として。Machine-idが無いと怒られたときの対処法のようです。</p>

<p><code>
dbus-uuidgen &gt; /var/lib/dbus/machine-id’
</code></p>

<h2 id="toc_39">IRBでテスト</h2>

<p>irb立ち上げて、USAGEにあるとおりに起動させてみます。</p>

<p>最後にdestroyしないでirbが終了したりすると、セッションが残ってしまって次にエラーになることがあります。実はこれにハマりましたが、ps aux でprocessを終了させたら元に戻りました。</p>

<h2 id="toc_40">参考にしたURL</h2>

<p><a href="https://gist.github.com/textarcana/5855427">https://gist.github.com/textarcana/5855427</a><br>
<a href="https://github.com/leonid-shevtsov/headless">https://github.com/leonid-shevtsov/headless</a><br>
<a href="http://blog.kjirou.net/p/1604">http://blog.kjirou.net/p/1604</a>  </p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RVMでrubyをアップデート]]></title>
    <link href="http://akiko74.github.com/blog/2013/10/06/rvm-update/"/>
    <updated>2013-10-06T13:38:00+09:00</updated>
    <id>http://akiko74.github.com/blog/2013/10/06/rvm-update</id>
    <content type="html"><![CDATA[<p>RVMを使ってプロジェクト毎にRubyやRailsのバージョン管理をしていますが、アップデートする機会が少ないので手順をメモ。</p>

<h1 id="toc_41">RVMの更新</h1>

<p>まずはRVMを最新にしてRubyのリストを更新します。</p>

<!--more-->

<p>rvm get latest と打つと最新版(バグあるかも）というものが取れるので、そのあたりはお好みで。</p>

<p>これでrvmがアップデートされました。</p>

<h1 id="toc_42">Rubyの更新</h1>

<p>次は、入れたいrubyのバージョンを取れているかを確認します。</p>

<p>おっと、2.1.0のプレビューまで入ってきました。
今回は2.0.0-p195を2.0.0-p247にアップデートしたい。ということで、次にrubyをアップデートします。</p>

<p>あとは、gemsetを移行するかとか、p195は消すかとか聞かれるので、Y/nで選びます。
勢いで全部Yにしましたが、どんな影響が出るのかはまだ未確認。てか影響出ないよね。。</p>

<p>gemsetを移行すると処理に時間がかかるので、その間にこういうメモが書けるという利点もあります(違</p>

<h1 id="toc_43">リファレンス</h1>

<p>RVMは分かりにくいし、まだgemsetの紐付けとか理解していないけど、<a href="https://rvm.io/">公式サイト</a>のドキュメントは充実してるので頑張って読む。RVMよりrbenvだって声もあるけど、今のところRVMでそれほど不便はないので理解するまでは移れないかな。</p>

<p>トップページに載ってるいわゆるアメリカンコミック風な絵にはいつも癒されます。</p>
]]></content>
  </entry>
  
</feed>
